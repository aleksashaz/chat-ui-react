"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MuiAudioInput = MuiAudioInput;

var _core = require("@material-ui/core");

var _icons = require("@material-ui/icons");

var _KeyboardVoice = _interopRequireDefault(require("@material-ui/icons/KeyboardVoice"));

var _react = _interopRequireDefault(require("react"));

var _audioMediaRecorder = require("../audio-media-recorder");

const useStyles = (0, _core.makeStyles)(theme => ({
  container: {
    flex: '1 1 auto',
    display: 'flex',
    '& > *': {
      flex: '1 1 auto',
      minWidth: 0
    },
    '& > * + *': {
      marginLeft: theme.spacing(1)
    }
  }
}));

function MuiAudioInput({
  chatController,
  actionRequest
}) {
  const classes = useStyles();
  const chatCtl = chatController;

  const [audioRec] = _react.default.useState(_audioMediaRecorder.AudioMediaRecorder.getInstance());

  const [stopped, setStopped] = _react.default.useState(true);

  const [audio, setAudio] = _react.default.useState();

  const handleError = _react.default.useCallback(error => {
    const value = {
      type: 'audio',
      value: error.message,
      error
    };
    chatCtl.setActionResponse(actionRequest, value);
  }, [actionRequest, chatCtl]);

  const handleStart = _react.default.useCallback(async () => {
    try {
      await audioRec.initialize();
      await audioRec.startRecord();
      setStopped(false);
    } catch (error) {
      handleError(error);
    }
  }, [audioRec, handleError]);

  const handleStop = _react.default.useCallback(async () => {
    try {
      const a = await audioRec.stopRecord();
      setAudio(a);
      setStopped(true);
    } catch (error) {
      handleError(error);
    }
  }, [audioRec, handleError]);

  const sendResponse = _react.default.useCallback(() => {
    if (audio) {
      const value = {
        type: 'audio',
        value: 'Audio',
        audio
      };
      chatCtl.setActionResponse(actionRequest, value);
      setAudio(undefined);
    }
  }, [actionRequest, audio, chatCtl]);

  const sendButtonText = actionRequest.sendButtonText ? actionRequest.sendButtonText : 'Send';
  return /*#__PURE__*/_react.default.createElement("div", {
    className: classes.container
  }, stopped && /*#__PURE__*/_react.default.createElement(_core.Button, {
    type: "button",
    onClick: handleStart,
    disabled: !stopped,
    variant: "contained",
    color: "primary",
    startIcon: /*#__PURE__*/_react.default.createElement(_KeyboardVoice.default, null)
  }, "Rec start"), !stopped && /*#__PURE__*/_react.default.createElement(_core.Button, {
    type: "button",
    onClick: handleStop,
    disabled: stopped,
    variant: "contained",
    color: "primary",
    startIcon: /*#__PURE__*/_react.default.createElement(_icons.Stop, null)
  }, "Rec stop"), /*#__PURE__*/_react.default.createElement(_core.Button, {
    type: "button",
    onClick: sendResponse,
    disabled: !audio,
    variant: "contained",
    color: "primary",
    startIcon: /*#__PURE__*/_react.default.createElement(_icons.Send, null)
  }, sendButtonText));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tdWkvTXVpQXVkaW9JbnB1dC50c3giXSwibmFtZXMiOlsidXNlU3R5bGVzIiwidGhlbWUiLCJjb250YWluZXIiLCJmbGV4IiwiZGlzcGxheSIsIm1pbldpZHRoIiwibWFyZ2luTGVmdCIsInNwYWNpbmciLCJNdWlBdWRpb0lucHV0IiwiY2hhdENvbnRyb2xsZXIiLCJhY3Rpb25SZXF1ZXN0IiwiY2xhc3NlcyIsImNoYXRDdGwiLCJhdWRpb1JlYyIsIlJlYWN0IiwidXNlU3RhdGUiLCJBdWRpb01lZGlhUmVjb3JkZXIiLCJnZXRJbnN0YW5jZSIsInN0b3BwZWQiLCJzZXRTdG9wcGVkIiwiYXVkaW8iLCJzZXRBdWRpbyIsImhhbmRsZUVycm9yIiwidXNlQ2FsbGJhY2siLCJlcnJvciIsInZhbHVlIiwidHlwZSIsIm1lc3NhZ2UiLCJzZXRBY3Rpb25SZXNwb25zZSIsImhhbmRsZVN0YXJ0IiwiaW5pdGlhbGl6ZSIsInN0YXJ0UmVjb3JkIiwiaGFuZGxlU3RvcCIsImEiLCJzdG9wUmVjb3JkIiwic2VuZFJlc3BvbnNlIiwidW5kZWZpbmVkIiwic2VuZEJ1dHRvblRleHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUlBLE1BQU1BLFNBQVMsR0FBRyxzQkFBWUMsS0FBRCxLQUFtQjtBQUM5Q0MsRUFBQUEsU0FBUyxFQUFFO0FBQ1RDLElBQUFBLElBQUksRUFBRSxVQURHO0FBRVRDLElBQUFBLE9BQU8sRUFBRSxNQUZBO0FBR1QsYUFBUztBQUNQRCxNQUFBQSxJQUFJLEVBQUUsVUFEQztBQUVQRSxNQUFBQSxRQUFRLEVBQUU7QUFGSCxLQUhBO0FBT1QsaUJBQWE7QUFDWEMsTUFBQUEsVUFBVSxFQUFFTCxLQUFLLENBQUNNLE9BQU4sQ0FBYyxDQUFkO0FBREQ7QUFQSjtBQURtQyxDQUFuQixDQUFYLENBQWxCOztBQWNPLFNBQVNDLGFBQVQsQ0FBdUI7QUFDNUJDLEVBQUFBLGNBRDRCO0FB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RkosRUFhRyxDQUFDQSxPQUFELGlCQUNDLDZCQUFDLFlBQUQ7QUFDRSxJQUFBLElBQUksRUFBQyxRQURQO0FBRUUsSUFBQSxPQUFPLEVBQUVjLFVBRlg7QUFHRSxJQUFBLFFBQVEsRUFBRWQsT0FIWjtBQUlFLElBQUEsT0FBTyxFQUFDLFdBSlY7QUFLRSxJQUFBLEtBQUssRUFBQyxTQUxSO0FBTUUsSUFBQSxTQUFTLGVBQUUsNkJBQUMsV0FBRDtBQU5iLGdCQWRKLGVBeUJFLDZCQUFDLFlBQUQ7QUFDRSxJQUFBLElBQUksRUFBQyxRQURQO0FBRUUsSUFBQSxPQUFPLEVBQUVpQixZQUZYO0FBR0UsSUFBQSxRQUFRLEVBQUUsQ0FBQ2YsS0FIYjtBQUlFLElBQUEsT0FBTyxFQUFDLFdBSlY7QUFLRSxJQUFBLEtBQUssRUFBQyxTQUxSO0FBTUUsSUFBQSxTQUFTLGVBQUUsNkJBQUMsV0FBRDtBQU5iLEtBUUdpQixjQVJILENBekJGLENBREY7QUFzQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCdXR0b24sIFRoZW1lLCBtYWtlU3R5bGVzIH0gZnJvbSAnQG1hdGVyaWFsLXVpL2NvcmUnO1xuaW1wb3J0IHsgU2VuZCBhcyBTZW5kSWNvbiwgU3RvcCBhcyBTdG9wSWNvbiB9IGZyb20gJ0BtYXRlcmlhbC11aS9pY29ucyc7XG5pbXBvcnQgS2V5Ym9hcmRWb2ljZUljb24gZnJvbSAnQG1hdGVyaWFsLXVpL2ljb25zL0tleWJvYXJkVm9pY2UnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgQXVkaW9NZWRpYVJlY29yZGVyIH0gZnJvbSAnLi4vYXVkaW8tbWVkaWEtcmVjb3JkZXInO1xuaW1wb3J0IHsgQ2hhdENvbnRyb2xsZXIgfSBmcm9tICcuLi9jaGF0LWNvbnRyb2xsZXInO1xuaW1wb3J0IHsgQXVkaW9BY3Rpb25SZXF1ZXN0LCBBdWRpb0FjdGlvblJlc3BvbnNlIH0gZnJvbSAnLi4vY2hhdC10eXBlcyc7XG5cbmNvbnN0IHVzZVN0eWxlcyA9IG1ha2VTdHlsZXMoKHRoZW1lOiBUaGVtZSkgPT4gKHtcbiAgY29udGFpbmVyOiB7XG4gICAgZmxleDogJzEgMSBhdXRvJyxcbiAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgJyYgPiAqJzoge1xuICAgICAgZmxleDogJzEgMSBhdXRvJyxcbiAgICAgIG1pbldpZHRoOiAwLFxuICAgIH0sXG4gICAgJyYgPiAqICsgKic6IHtcbiAgICAgIG1hcmdpbkxlZnQ6IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgfSxcbiAgfSxcbn0pKTtcblxuZXhwb3J0IGZ1bmN0aW9uIE11aUF1ZGlvSW5wdXQoe1xuICBjaGF0Q29udHJvbGxlcixcbiAgYWN0aW9uUmVxdWVzdCxcbn06IHtcbiAgY2hhdENvbnRyb2xsZXI6IENoYXRDb250cm9sbGVyO1xuICBhY3Rpb25SZXF1ZXN0OiBBdWRpb0FjdGlvblJlcXVlc3Q7XG59KTogUmVhY3QuUmVhY3RFbGVtZW50IHtcbiAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcygpO1xuICBjb25zdCBjaGF0Q3RsID0gY2hhdENvbnRyb2xsZXI7XG4gIGNvbnN0IFthdWRpb1JlY10gPSBSZWFjdC51c2VTdGF0ZShBdWRpb01lZGlhUmVjb3JkZXIuZ2V0SW5zdGFuY2UoKSk7XG4gIGNvbnN0IFtzdG9wcGVkLCBzZXRTdG9wcGVkXSA9IFJlYWN0LnVzZVN0YXRlKHRydWUpO1xuICBjb25zdCBbYXVkaW8sIHNldEF1ZGlvXSA9IFJlYWN0LnVzZVN0YXRlPEJsb2IgfCB1bmRlZmluZWQ+KCk7XG5cbiAgY29uc3QgaGFuZGxlRXJyb3IgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICAoZXJyb3I6IEVycm9yKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCB2YWx1ZTogQXVkaW9BY3Rpb25SZXNwb25zZSA9IHtcbiAgICAgICAgdHlwZTogJ2F1ZGlvJyxcbiAgICAgICAgdmFsdWU6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGVycm9yLFxuICAgICAgfTtcbiAgICAgIGNoYXRDdGwuc2V0QWN0aW9uUmVzcG9uc2UoYWN0aW9uUmVxdWVzdCwgdmFsdWUpO1xuICAgIH0sXG4gICAgW2FjdGlvblJlcXVlc3QsIGNoYXRDdGxdLFxuICApO1xuXG4gIGNvbnN0IGhhbmRsZVN0YXJ0ID0gUmVhY3QudXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBhdWRpb1JlYy5pbml0aWFsaXplKCk7XG4gICAgICBhd2FpdCBhdWRpb1JlYy5zdGFydFJlY29yZCgpO1xuICAgICAgc2V0U3RvcHBlZChmYWxzZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGhhbmRsZUVycm9yKGVycm9yKTtcbiAgICB9XG4gIH0sIFthdWRpb1JlYywgaGFuZGxlRXJyb3JdKTtcblxuICBjb25zdCBoYW5kbGVTdG9wID0gUmVhY3QudXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhID0gYXdhaXQgYXVkaW9SZWMuc3RvcFJlY29yZCgpO1xuICAgICAgc2V0QXVkaW8oYSk7XG4gICAgICBzZXRTdG9wcGVkKHRydWUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBoYW5kbGVFcnJvcihlcnJvcik7XG4gICAgfVxuICB9LCBbYXVkaW9SZWMsIGhhbmRsZUVycm9yXSk7XG5cbiAgY29uc3Qgc2VuZFJlc3BvbnNlID0gUmVhY3QudXNlQ2FsbGJhY2soKCk6IHZvaWQgPT4ge1xuICAgIGlmIChhdWRpbykge1xuICAgICAgY29uc3QgdmFsdWU6IEF1ZGlvQWN0aW9uUmVzcG9uc2UgPSB7XG4gICAgICAgIHR5cGU6ICdhdWRpbycsXG4gICAgICAgIHZhbHVlOiAnQXVkaW8nLFxuICAgICAgICBhdWRpbyxcbiAgICAgIH07XG4gICAgICBjaGF0Q3RsLnNldEFjdGlvblJlc3BvbnNlKGFjdGlvblJlcXVlc3QsIHZhbHVlKTtcbiAgICAgIHNldEF1ZGlvKHVuZGVmaW5lZCk7XG4gICAgfVxuICB9LCBbYWN0aW9uUmVxdWVzdCwgYXVkaW8sIGNoYXRDdGxdKTtcblxuICBjb25zdCBzZW5kQnV0dG9uVGV4dCA9IGFjdGlvblJlcXVlc3Quc2VuZEJ1dHRvblRleHRcbiAgICA/IGFjdGlvblJlcXVlc3Quc2VuZEJ1dHRvblRleHRcbiAgICA6ICdTZW5kJztcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzLmNvbnRhaW5lcn0+XG4gICAgICB7c3RvcHBlZCAmJiAoXG4gICAgICAgIDxCdXR0b25cbiAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVTdGFydH1cbiAgICAgICAgICBkaXNhYmxlZD17IXN0b3BwZWR9XG4gICAgICAgICAgdmFyaWFudD1cImNvbnRhaW5lZFwiXG4gICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICBzdGFydEljb249ezxLZXlib2FyZFZvaWNlSWNvbiAvPn1cbiAgICAgICAgPlxuICAgICAgICAgIFJlYyBzdGFydFxuICAgICAgICA8L0J1dHRvbj5cbiAgICAgICl9XG4gICAgICB7IXN0b3BwZWQgJiYgKFxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgb25DbGljaz17aGFuZGxlU3RvcH1cbiAgICAgICAgICBkaXNhYmxlZD17c3RvcHBlZH1cbiAgICAgICAgICB2YXJpYW50PVwiY29udGFpbmVkXCJcbiAgICAgICAgICBjb2xvcj1cInByaW1hcnlcIlxuICAgICAgICAgIHN0YXJ0SWNvbj17PFN0b3BJY29uIC8+fVxuICAgICAgICA+XG4gICAgICAgICAgUmVjIHN0b3BcbiAgICAgICAgPC9CdXR0b24+XG4gICAgICApfVxuICAgICAgPEJ1dHRvblxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgb25DbGljaz17c2VuZFJlc3BvbnNlfVxuICAgICAgICBkaXNhYmxlZD17IWF1ZGlvfVxuICAgICAgICB2YXJpYW50PVwiY29udGFpbmVkXCJcbiAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgc3RhcnRJY29uPXs8U2VuZEljb24gLz59XG4gICAgICA+XG4gICAgICAgIHtzZW5kQnV0dG9uVGV4dH1cbiAgICAgIDwvQnV0dG9uPlxuICAgIDwvZGl2PlxuICApO1xufVxuIl19